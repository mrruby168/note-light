<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#fff8dc">
<meta name="description" content="·ª®ng d·ª•ng ghi ch√∫ nhanh">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="Quick Notes">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon-192.png">
<title>Quick Notes</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#f0f2f5;height:100vh;height:100dvh;overflow:hidden;color:#1f2937}
.app{display:flex;height:100%;padding:20px;gap:20px}
.sidebar{width:280px;background:linear-gradient(180deg,#fff8dc,#ffeeba);border-radius:16px;display:flex;flex-direction:column;box-shadow:0 10px 40px rgba(0,0,0,0.1);border:1px solid rgba(255,200,100,0.3)}
.sidebar-header{padding:18px 15px;background:rgba(255,255,255,0.4);display:flex;align-items:center;justify-content:space-between;border-radius:16px 16px 0 0}
.sidebar-header h1{font-size:20px;font-weight:700}
.btn-new{width:40px;height:40px;border:none;border-radius:12px;background:linear-gradient(135deg,#ff8a9b,#ff6b7a);color:#fff;font-size:24px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 12px rgba(255,107,122,0.4);transition:transform .2s}
.btn-new:hover{transform:scale(1.08)}
.note-list{flex:1;overflow-y:auto;padding:10px}
.note-list::-webkit-scrollbar{width:4px}
.note-list::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.15);border-radius:2px}
.note-item{background:rgba(255,255,255,0.7);border-radius:10px;padding:12px 14px;margin-bottom:8px;cursor:pointer;transition:all .15s;border:2px solid transparent;display:flex;align-items:center;justify-content:space-between;gap:10px}
.note-item:hover{background:#fff;transform:translateX(4px)}
.note-item.active{background:#fff;border-color:#f59e0b}
.note-title{font-size:16px;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}
.delete-btn{width:24px;height:24px;border:none;border-radius:6px;background:transparent;color:#ccc;font-size:16px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .15s;flex-shrink:0}
.delete-btn:hover{background:rgba(239,68,68,0.15);color:#ef4444}
.empty-list{text-align:center;padding:40px 15px;color:#999;font-size:14px}
.main{flex:1;background:#fff;border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.1);display:flex;flex-direction:column;position:relative}
.toolbar{padding:12px 16px;background:linear-gradient(135deg,#ffecd2,#fcb69f);display:flex;align-items:center;gap:6px;border-radius:16px 16px 0 0;flex-wrap:wrap}
.tool-group{display:flex;gap:3px;padding:3px;background:rgba(255,255,255,0.5);border-radius:8px}
.tool-btn{width:32px;height:32px;border:none;border-radius:6px;background:transparent;color:#1f2937;font-size:14px;font-weight:600;cursor:pointer;transition:background .15s;display:flex;align-items:center;justify-content:center}
.tool-btn:hover{background:rgba(255,255,255,0.8)}
.tool-btn.bold{font-weight:800}
.tool-btn.italic{font-style:italic}
.tool-btn.underline{text-decoration:underline}
.tool-btn.red{color:#ef4444}
.divider{width:1px;height:22px;background:rgba(0,0,0,0.1);margin:0 6px}
input[type="color"]{width:28px;height:28px;border:2px solid rgba(255,255,255,0.8);border-radius:6px;cursor:pointer;background:none;padding:0}
input[type="color"]::-webkit-color-swatch-wrapper{padding:2px}
input[type="color"]::-webkit-color-swatch{border-radius:3px;border:none}
select{padding:4px 8px;border:2px solid rgba(255,255,255,0.8);border-radius:6px;background:rgba(255,255,255,0.8);font-size:12px;cursor:pointer;outline:none}
.editor{flex:1;display:flex;flex-direction:column;padding:20px 25px 20px}
.title-input{font-size:24px;font-weight:700;border:none;outline:none;background:transparent;margin-bottom:15px}
.title-input::placeholder{color:#ccc}
.content{flex:1;border:none;outline:none;font-size:25px;line-height:1.6;overflow-y:auto;resize:none}
.content:empty::before{content:attr(data-placeholder);color:#ccc;pointer-events:none}
.content::-webkit-scrollbar{width:4px}
.content::-webkit-scrollbar-thumb{background:#ddd;border-radius:2px}
.content ul,.content ol{margin-left:30px;margin-bottom:10px}
.content li{margin-bottom:5px}
.save-indicator{position:absolute;bottom:18px;right:18px;padding:8px 16px;background:rgba(16,185,129,0.1);color:#10b981;border-radius:8px;font-size:14px;font-weight:600;opacity:0;transition:opacity .3s}
.save-indicator.show{opacity:1}
.empty-state{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#999}
.empty-state span{font-size:50px;margin-bottom:10px}
.install-btn{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);padding:12px 24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border:none;border-radius:25px;font-size:14px;font-weight:600;cursor:pointer;box-shadow:0 4px 15px rgba(102,126,234,0.4);display:none;z-index:100}
@media(max-width:768px){.app{flex-direction:column;padding:10px;gap:10px}.sidebar{width:100%;max-height:35%;min-height:180px}.toolbar{padding:10px 12px}.editor{padding:15px}}
</style>
</head>
<body>
<div class="app">
<aside class="sidebar">
<div class="sidebar-header">
<h1>Quick Notes</h1>
<button class="btn-new" onclick="addNote()">+</button>
</div>
<div class="note-list" id="list"></div>
</aside>
<main class="main" id="main">
<div class="empty-state" id="empty">
<span>üìã</span>
<p>Nh·∫•n + ƒë·ªÉ t·∫°o ghi ch√∫</p>
</div>
<div id="editor" style="display:none;flex-direction:column;height:100%">
<div class="toolbar">
<div class="tool-group">
<button class="tool-btn bold" onclick="fmt('bold')" title="In ƒë·∫≠m">B</button>
<button class="tool-btn italic" onclick="fmt('italic')" title="In nghi√™ng">I</button>
<button class="tool-btn underline" onclick="fmt('underline')" title="G·∫°ch ch√¢n">U</button>
</div>
<div class="divider"></div>
<div class="tool-group">
<button class="tool-btn red" onclick="fmt('foreColor','#ef4444')" title="Ch·ªØ ƒë·ªè">A</button>
</div>
<div class="divider"></div>
<input type="color" value="#1f2937" onchange="fmt('foreColor',this.value)" title="M√†u ch·ªØ">
<div class="divider"></div>
<select onchange="setSize(this.value)" title="C·ª° ch·ªØ">
<option value="16">16px</option>
<option value="20">20px</option>
<option value="25" selected>25px</option>
<option value="32">32px</option>
<option value="40">40px</option>
</select>
<div class="divider"></div>
<div class="tool-group">
<button class="tool-btn" onclick="fmt('insertOrderedList')" title="Danh s√°ch 1,2,3">1.</button>
<button class="tool-btn" onclick="fmt('insertUnorderedList')" title="Danh s√°ch ch·∫•m tr√≤n">‚Ä¢</button>
</div>
</div>
<div class="editor">
<input class="title-input" id="title" placeholder="Ti√™u ƒë·ªÅ...">
<div class="content" id="content" contenteditable data-placeholder="Vi·∫øt n·ªôi dung..."></div>
</div>
<div class="save-indicator" id="saveIndicator">‚úì ƒê√£ l∆∞u</div>
</div>
</main>
</div>
<button class="install-btn" id="installBtn" onclick="installPWA()">üì≤ C√†i ƒë·∫∑t ·ª©ng d·ª•ng</button>

<script>
let data = JSON.parse(localStorage.getItem('quicknotes') || '[]');
let cur = null;
let nid = data.length ? Math.max(...data.map(n => n.id)) + 1 : 1;
let saveTimeout = null;
const $ = id => document.getElementById(id);

function render() {
    const list = $('list');
    const sorted = [...data].sort((a, b) => (a.title || '').localeCompare(b.title || '', 'vi'));
    if (!sorted.length) {
        list.innerHTML = '<div class="empty-list">Ch∆∞a c√≥ ghi ch√∫</div>';
        return;
    }
    list.innerHTML = sorted.map(n => `
        <div class="note-item${n.id === cur ? ' active' : ''}" onclick="sel(${n.id})">
            <span class="note-title">${n.title || 'Ch∆∞a c√≥ ti√™u ƒë·ªÅ'}</span>
            <button class="delete-btn" onclick="event.stopPropagation();del(${n.id})" title="X√≥a">√ó</button>
        </div>
    `).join('');
}

function showSaveIndicator() {
    const indicator = $('saveIndicator');
    indicator.classList.add('show');
    setTimeout(() => indicator.classList.remove('show'), 1500);
}

function save() {
    if (!cur) return;
    const n = data.find(x => x.id === cur);
    if (!n) return;
    n.title = $('title').value;
    n.content = $('content').innerHTML;
    localStorage.setItem('quicknotes', JSON.stringify(data));
    render();
    showSaveIndicator();
}

function autoSave() {
    if (saveTimeout) clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
        if (!cur) return;
        const n = data.find(x => x.id === cur);
        if (!n) return;
        n.title = $('title').value;
        n.content = $('content').innerHTML;
        localStorage.setItem('quicknotes', JSON.stringify(data));
        render();
    }, 500);
}

function addNote() {
    // L∆∞u note hi·ªán t·∫°i tr∆∞·ªõc khi t·∫°o m·ªõi
    if (cur) {
        const n = data.find(x => x.id === cur);
        if (n) {
            n.title = $('title').value;
            n.content = $('content').innerHTML;
            localStorage.setItem('quicknotes', JSON.stringify(data));
        }
    }
    
    // T·∫°o note m·ªõi
    const n = { id: nid++, title: '', content: '' };
    data.push(n);
    localStorage.setItem('quicknotes', JSON.stringify(data));
    sel(n.id);
    $('title').focus();
    showSaveIndicator();
}

function sel(id) {
    // L∆∞u note hi·ªán t·∫°i tr∆∞·ªõc khi chuy·ªÉn
    if (cur && cur !== id) {
        const n = data.find(x => x.id === cur);
        if (n) {
            n.title = $('title').value;
            n.content = $('content').innerHTML;
            localStorage.setItem('quicknotes', JSON.stringify(data));
        }
    }
    
    cur = id;
    const n = data.find(x => x.id === id);
    if (!n) return;
    $('empty').style.display = 'none';
    $('editor').style.display = 'flex';
    $('title').value = n.title;
    $('content').innerHTML = n.content;
    render();
}

function del(id) {
    const i = data.findIndex(x => x.id === id);
    if (i > -1) data.splice(i, 1);
    localStorage.setItem('quicknotes', JSON.stringify(data));
    if (id === cur) {
        cur = null;
        $('empty').style.display = 'flex';
        $('editor').style.display = 'none';
    }
    render();
}

function fmt(c, v = null) {
    document.execCommand(c, false, v);
    $('content').focus();
    autoSave();
}

function setSize(px) {
    document.execCommand('fontSize', false, '7');
    $('content').querySelectorAll('font[size="7"]').forEach(f => {
        f.removeAttribute('size');
        f.style.fontSize = px + 'px';
    });
    $('content').focus();
    autoSave();
}

// Auto-save khi g√µ
$('title').addEventListener('input', autoSave);
$('content').addEventListener('input', autoSave);

document.onkeydown = e => {
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        save();
    }
};

// L∆∞u khi r·ªùi trang
window.addEventListener('beforeunload', () => {
    if (cur) {
        const n = data.find(x => x.id === cur);
        if (n) {
            n.title = $('title').value;
            n.content = $('content').innerHTML;
            localStorage.setItem('quicknotes', JSON.stringify(data));
        }
    }
});

let deferredPrompt;
window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault();
    deferredPrompt = e;
    $('installBtn').style.display = 'block';
});

function installPWA() {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then(() => {
        deferredPrompt = null;
        $('installBtn').style.display = 'none';
    });
}

window.addEventListener('appinstalled', () => {
    $('installBtn').style.display = 'none';
});

if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js');
}

render();
</script>
</body>
</html>
